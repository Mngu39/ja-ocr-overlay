/* ==== Base / Layout ======================================================= */
:root{
  --bg:#0b0b0d;
  --fg:#e7e7ea;
  --muted:#a9acb3;
  --card:#18181c;
  --border:rgba(255,255,255,.12);
  --accent:#3aa3ff;
}

*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; background:#000; color:var(--fg); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans CJK KR","Noto Sans CJK JP","Noto Sans JP",sans-serif; }

.topbar{
  position:sticky; top:0; z-index:10;
  height:44px; display:flex; align-items:center; padding:0 12px;
  background:rgba(0,0,0,.7); backdrop-filter:saturate(140%) blur(6px);
  border-bottom:1px solid var(--border);
  font-weight:600; letter-spacing:.2px;
}

#app{ display:flex; flex-direction:column; gap:8px; padding:10px; }

/* Stage: 이미지와 오버레이 컨테이너 */
#stage{
  position:relative; margin:0 auto; max-width:min(96vw,1800px);
  background:#000; border-radius:8px; overflow:hidden;
}
#img{ display:block; width:100%; height:auto; user-select:none; -webkit-user-drag:none; }

#overlay{
  position:absolute; inset:0; pointer-events:auto;
}

/* 안내 텍스트 */
.hint{
  text-align:center; color:var(--muted); font-size:14px; padding:4px 0;
}

/* ==== OCR Boxes =========================================================== */
.box{
  position:absolute; pointer-events:auto;
  border:2px solid rgba(0,180,255,.55);
  border-radius:6px;
  background:transparent;
}
.box:hover{ border-color:rgba(0,200,255,.8); }
.box.active{ outline:2px solid rgba(0,150,255,.6); }

/* ==== Main Popover ======================================================== */
.pop{
  position:absolute; inset:auto auto 0 0; /* 실제 위치는 JS가 배치 */
  z-index:50; background:var(--card); color:var(--fg);
  border:1px solid var(--border); border-radius:12px;
  box-shadow:0 8px 30px rgba(0,0,0,.5);
  max-width:min(640px,92vw);
}
.pop[hidden]{ display:none !important; }

.pop-arrow{
  position:absolute; width:16px; height:16px; transform:rotate(45deg);
  background:var(--card); border-left:1px solid var(--border); border-top:1px solid var(--border);
  /* JS에서 top/bottom/left/right 조정 */
}

.pop .pop-body{
  padding:10px 12px; display:flex; flex-direction:column; gap:8px;
}

/* 루비/원문/번역 — Sudachi 번역기 스타일 */
.ruby-line{
  font-size:12px; opacity:.85; line-height:1.25; word-break:break-word;
  user-select:none; -webkit-user-select:none;
}
.orig-line{
  font-size:16px; line-height:1.6; word-break:break-word;
  user-select:none; -webkit-user-select:none;
}
.orig-line .tok{
  cursor:pointer; border-bottom:1px dotted transparent; transition:border-color .15s ease;
}
.orig-line .tok:hover{ border-bottom-color:currentColor; }

.trans-line{
  font-size:14px; opacity:.95; line-height:1.45; white-space:pre-wrap; word-break:break-word;
}

/* 편집 라인 */
.edit-line{ display:flex; align-items:center; gap:6px; }
.edit{ display:flex; flex-direction:column; gap:6px; width:100%; }
.edit textarea{
  width:100%; min-height:64px; max-height:40vh; resize:vertical;
  border-radius:8px; border:1px solid var(--border); background:#0d0e12; color:var(--fg);
  padding:8px 10px; font-size:14px; line-height:1.5;
}
.tiny{
  appearance:none; border:1px solid var(--border); background:#111318; color:var(--fg);
  border-radius:10px; padding:6px 10px; font-size:13px;
}
.tiny.primary{ border-color:transparent; background:var(--accent); color:#001525; font-weight:600; }
.tiny:active{ transform:translateY(1px); }

/* ==== Sub Popover (형태소 설명) ========================================= */
.subpop{
  position:absolute; z-index:60; background:#111318; color:var(--fg);
  border:1px solid var(--border); border-radius:10px; padding:8px 10px;
  max-width:min(420px,92vw); box-shadow:0 8px 30px rgba(0,0,0,.5);
}
.subpop[hidden]{ display:none !important; }

/* 꼬리(삼각형) */
.tail-svg{
  position:absolute; z-index:59; pointer-events:none;
  width:14px; height:14px; fill:#111318; stroke:var(--border);
}

/* 외부 링크 버튼(서브팝업 내부) */
a.ext{ font-size:12px; color:#8bc7ff; text-decoration:none; padding:2px 6px; border-radius:6px; background:#0b1a26; }
a.ext:hover{ background:#0e2334; }

/* ==== Utility ============================================================= */
.hidden{ display:none !important; }

/* 작은 화면 보정 */
@media (max-width: 480px){
  .pop{ max-width:94vw; }
  .orig-line{ font-size:15px; }
  .trans-line{ font-size:13px; }
}

/* iPad Safari 상단/하단 안전 여백 */
@supports (padding: max(0px)) {
  body{ padding-bottom: max(env(safe-area-inset-bottom), 0px); }
}
