:root{
  --bg:#0b0b0c; --ink:#e8e8ea; --muted:#a9abb3; --accent:#4da3ff;
  --box:#4da3ff; --box-active:#00d4ff; --pop:#141417; --border:#2a2a31;
}

*{ box-sizing:border-box; }
html,body{
  margin:0; height:100%;
  background:var(--bg); color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans CJK KR","Noto Sans JP","Malgun Gothic",sans-serif;
}
#stage{ position:relative; width:100%; min-height:100vh; display:grid; place-items:center; padding:10px; }

#img{ max-width:100%; height:auto; display:block; border-radius:10px; box-shadow:0 6px 30px rgba(0,0,0,.4); }
#overlay{ position:absolute; inset:0; margin:auto; pointer-events:auto; }
#hint{ position:absolute; left:0; right:0; bottom:18px; text-align:center; color:var(--muted); font-size:14px; }

/* 박스 */
.box{ position:absolute; border:2px solid var(--box); border-radius:10px; background:transparent; cursor:pointer; }
.box.selected{ border-color:var(--box-active); box-shadow:0 0 0 2px rgba(0,212,255,.22) inset; background:rgba(80,200,255,.10); }
.box .ord{
  position:absolute; right:4px; top:2px; background:#50c8ff; color:#002331;
  font-weight:700; padding:0 6px; border-radius:10px; font-size:12px;
}

/* 메인 팝업 */
.popover{
  position:absolute; max-width:min(92vw, 900px);
  background:var(--pop); color:var(--ink);
  border:1px solid var(--border); border-radius:14px;
  padding:10px 12px 12px; box-shadow:0 12px 40px rgba(0,0,0,.5); z-index:50;
}
.pop-head{ display:flex; align-items:center; justify-content:center; margin:2px 0 6px; }
.drag-handle{ width:140px; height:6px; border-radius:4px; background:#2a2f3b; opacity:.7; }
.drag-handle.small{ width:100px; height:5px; }

/* 루비/번역 */
.ruby-line{ line-height:1.85; font-size:18px; color:#cfd4ff; word-break:break-word; }
.ruby-line ruby{ ruby-position:over; ruby-align:center; }
.ruby-line rt{ font-size:12px; color:#9fb3ff; }
.tok{ padding:2px 4px; border-radius:6px; }
.tok:hover{ background:#1f2433; cursor:pointer; }
.trans-line{ font-size:18px; line-height:1.7; color:#e7f6ff; word-break:break-word; }

.sep{ border:none; border-top:1px solid var(--border); margin:8px 0; }

/* 얇고 긴 방향바(팝업 '내부'에 깔림) */
.arrow-bar{
  position:absolute; opacity:.55; background:#2b2f3a; border:none; border-radius:6px; cursor:pointer; padding:0;
}
.arrow-top, .arrow-bottom{ height:8px; left:8px; right:8px; }
.arrow-top{ top:4px; }
.arrow-bottom{ bottom:4px; }
.arrow-left, .arrow-right{ width:8px; top:8px; bottom:8px; }
.arrow-left{ left:4px; }
.arrow-right{ right:4px; }
.arrow-bar:hover{ opacity:.85; }
.arrow-bar.disabled{ opacity:.25; cursor:not-allowed; background:repeating-linear-gradient(45deg,#333,#333 6px,#3b3b3b 6px,#3b3b3b 12px); }

/* 우측 아이콘 도킹(✎/✕) — 팝업 외측에 살짝 붙임 */
.side-dock{
  position:absolute; right:-44px; top:8px; width:36px;
  display:flex; flex-direction:column; gap:10px; z-index:60;
}
.side-dock .icon{
  width:36px; height:36px; border-radius:18px; border:none; cursor:pointer;
  background:#2e2e2e; color:#fff; font-size:18px; line-height:36px; text-align:center;
}
.side-dock .icon:hover{ filter:brightness(1.1); }

/* 서브 팝업 */
.subpop{
  position:absolute; max-width:86vw; background:var(--pop); color:var(--ink);
  border:1px solid var(--border); border-radius:12px; padding:8px 10px; z-index:60; box-shadow:0 8px 30px rgba(0,0,0,.5);
}
.sub-head{ display:flex; align-items:center; gap:10px; margin-bottom:6px; }
#subTitle a{ color:#a8ccff; text-decoration:underline; font-weight:800; }
#subTitle .lemma{ opacity:.8; margin-left:8px; font-weight:600; }
.sub-row{ margin:4px 0; font-size:14px; line-height:1.6; }

.kwrap{ display:flex; flex-wrap:wrap; gap:6px; }
.k{ border:1px solid #2a2f3b; padding:4px 8px; border-radius:8px; font-weight:700; }
.k small{ display:block; font-weight:600; opacity:.9; margin-top:2px; }
.k.anki{ background:#2d3b29; color:#e8f6e8; } /* ANKI: 초록 */
.k.db{ background:#222a39; color:#e8eefc; }   /* 일반DB: 남색 */
.k-explain{ font-size:13px; opacity:.95; margin-top:4px; }

/* 버튼 */
.btn{ background:var(--accent); color:#021323; border:none; padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer; }
.btn.ghost{ background:transparent; color:var(--muted); border:1px solid var(--border); }
.btn.sm{ padding:6px 10px; font-size:12px; }

/* dialog */
dialog{ border:none; border-radius:12px; background:var(--pop); color:var(--ink); }
.edit-form{ display:flex; flex-direction:column; gap:8px; min-width:min(86vw, 560px); }
textarea{ width:100%; background:#11121a; color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:8px; font-size:16px; }
menu{ display:flex; justify-content:flex-end; gap:8px; margin:0; padding:0; }

/* 선택 방지 */
img, .box, .popover, .subpop{ -webkit-user-select:none; user-select:none; }
